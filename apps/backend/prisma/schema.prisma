generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  user
  agent
  admin
}

enum TicketPriority {
  low
  medium
  high
}

enum TicketStatus {
  open
  in_progress
  resolved
}

enum IssueType {
  hardware
  software
  network
  access
  other
}

model User {
  id           String         @id @default(uuid())
  name         String
  email        String         @unique
  passwordHash String
  role         Role           @default(user)
  tickets      Ticket[]       @relation("TicketCreator")
  assignments  Ticket[]       @relation("TicketAssignee")
  assignmentRequests Ticket[] @relation("TicketAssignmentRequests")
  devices      DeviceToken[]
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
}

model Ticket {
  id          String        @id @default(uuid())
  createdBy   String
  creator     User          @relation("TicketCreator", fields: [createdBy], references: [id])
  assignedTo  String?
  assignee    User?         @relation("TicketAssignee", fields: [assignedTo], references: [id])
  priority    TicketPriority @default(medium)
  issueType   IssueType      @default(other)
  status      TicketStatus   @default(open)
  description String
  attachments String[]
  assignmentRequestId String?
  assignmentRequest   User?    @relation("TicketAssignmentRequests", fields: [assignmentRequestId], references: [id])
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  resolvedAt  DateTime?
}

model DeviceToken {
  id          String   @id @default(uuid())
  user        User     @relation(fields: [userId], references: [id])
  userId      String
  deviceToken String
  platform    String
  updatedAt   DateTime  @updatedAt

  @@unique([userId, deviceToken])
}
